---
title: "SenatorTwitterDB"
author: "Melissa Michels"
date: "4/8/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

# Load the data that we scraped
```{r}
load("tweetsMidAll.Rda")
load("tweetsEndAll.Rda")
load("tweetsBegAll.Rda")
```

# Combine all tweets into one dataframe
```{r}
all_tweets <- rbind(tweets_beg_all, tweets_mid_all ,tweets_end_all)
```

# Create the senator personal information tibble
```{r}
load("senatorDataDF.Rda")
senator_personal_information_df <- as.data.frame(senatorsdf)
head(senator_personal_information_df)

senator_rename <- c("State", "Name", "Username")
colnames(senator_personal_information_df) <- senator_rename

```

# Create the tweet information tibble
```{r}
tweet_information <- all_tweets %>% select(screen_name, 
                                           status_id, 
                                           text, 
                                           created_at, 
                                           is_retweet, 
                                           favorite_count, 
                                           retweet_count, 
                                           hashtags)
# cleaning up is_retweet and hashtags column
tweet_information$is_retweet <- as.integer(as.logical(tweet_information$is_retweet))
getHashTags <- function(x) {
  paste(unlist(x), collapse=',')
}
result <- lapply(tweet_information$hashtags, getHashTags)
result <- unlist(result)

tweet_information$hashtags <- result

tweet_information_df <- data.frame(tweet_information)

tweet_information_names <- c("Username", "Status_Id",  "Text", "Created_at", "Is_Retweet","Favorite_count", "Retweet_count", "Hashtag")
colnames(tweet_information_df) <- tweet_information_names

```



# Create the tweet meta data tibble
```{r}
tweet_meta <- all_tweets %>% select(user_id,
                                    status_id,
                                    screen_name,
                                    source,
                                    reply_to_screen_name,
                                    lang,
                                    quoted_text,
                                    quoted_source,
                                    status_url,
                                    description,
                                    followers_count,
                                    friends_count,
                                    statuses_count,
                                    verified,
                                    profile_url)

# cleaning up verified column

tweet_meta$verified <- as.integer(as.logical(tweet_meta$verified))

tweet_meta_df <- data.frame(tweet_meta)

tweet_meta_df_names <- c("UserId", "Status_Id", "Username" , "Source", "Reply_to_screen_name", "Lang",
            "Quoted_text", "Quoted_source", "Status_url","Description", "Followers_count", "Friends_count",
            "Statuses_count", "Verified", "Profile_url")
colnames(tweet_meta_df) <- tweet_meta_df_names


```

```{r }

library("RSQLite")
db<-dbConnect(SQLite(),dbname="test.sqlite")
summary(db)

# Create Senator table 
dbRemoveTable(db, "Senators_PI")
dbSendQuery(conn=db, "CREATE TABLE Senators_PI ( State TEXT, Name TEXT, Username TEXT PRIMARY KEY)")
dbWriteTable(conn = db, name = "Senators_PI", value = senator_personal_information_df, row.names = F, append = T)
dbReadTable(db, "Senators_PI")

# Create Tweet table 
dbRemoveTable(db, "Tweets")
dbSendQuery(conn=db, "CREATE TABLE Tweets (Username TEXT, 
            Status_Id TEXT, 
            Text TEXT,
            Created_at TEXT,
            Is_Retweet INTEGER,
            Favorite_count INTEGER, 
        Retweet_count INTEGER,
            Hashtag TEXT, 
            PRIMARY KEY (Username, Status_Id))")
dbWriteTable(conn = db, name = "Tweets", value = tweet_information_df, row.names = F, append = T)
dbReadTable(db, "Tweets")

# Additional data
dbRemoveTable(db, "Tweet_Metadata")

dbSendQuery(conn=db, "CREATE TABLE Tweet_Metadata (UserID INTEGER,
            Status_Id TEXT PRIMARY KEY, 
            Username TEXT, 
            Source TEXT,
            Reply_to_screen_name TEXT,
            Lang TEXT,
            Quoted_text TEXT,
            Quoted_source TEXT,
            Status_url TEXT,
            Description TEXT, 
            Followers_count INTEGER,
            Friends_count INTEGER,
            Statuses_count INTEGER, 
            Verified INT,
            Profile_url TEXT)")
dbWriteTable(conn = db, name = "Tweet_Metadata", value = tweet_meta_df, row.names = F, append = T)
dbReadTable(db, "Tweet_Metadata")

dbListTables(db)

```
